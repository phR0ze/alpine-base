name: Publish Docker Image
on:
  release:
    types: [published]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1

    # Set release tag
    - name: Set the release tag
      id: release
      run: echo ::set-output name=tag::$(basename "${GITHUB_REF}")

    # Build image
    - name: Build Docker image with release tag
      run: docker build . -f Dockerfile -t alpine-base:${{ steps.release.outputs.tag }}

    # Tag latest image
    - name: Build Docker image latest
      run: docker tag alpine-base:${{ steps.release.outputs.tag }} alpine-base:latest

    # Publish both images/tags
    - name: Publish both images/tags
      run: |
        docker push docker.pkg.github.com/phR0ze/alpine-base/alpine-base:${{ steps.release.outputs.tag }}
        docker push docker.pkg.github.com/phR0ze/alpine-base/alpine-base:latest
